<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Domanda o Verità – Invito</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css?v=1_0_0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="firebase-config.js?v=1_0_0"></script>
<script src="firebase-init.js?v=1_0_0"></script>
<script src="common.js?v=1_0_0"></script>
</head>
<body>
<div class="version">MVP 1.0.0 – Invito</div>
<main>
  <section class="panel">
    <h2>Hai ricevuto un invito</h2>
    <div class="cols2">
      <div>
        <label>Il tuo nome</label>
        <input id="name" placeholder="Nome giocatore 2">
      </div>
      <div>
        <label>Stato</label>
        <input id="stat" readonly value="In attesa azione…">
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="bigBtn" id="accept">Accetta</button>
      <button class="secondary" id="decline">Rifiuta</button>
    </div>
  </section>
</main>
<script>
(function(){
  const {qs, gid, role} = DV;
  const G = gid(); const R = role()||'p2';
  const nm = qs('#name'), stat = qs('#stat');
  if(!G) { alert('Link non valido'); location.href='index.html'; return; }

  DB.ref('games/'+G).once('value').then(s=>{
    const d=s.val();
    if(!d) { alert('Partita inesistente o scaduta'); location.href='index.html'; }
    else if(d.phase!=='invite'){ stat.value='Invito non più valido.'; }
  });

  qs('#accept').onclick = async ()=>{
    const name = (nm.value||'').trim() || 'Giocatore 2';
    await DB.ref('games/'+G+'/player2').set({name});
    await DB.ref('games/'+G+'/phase').set('choose');
    stat.value='Accettato. Vai alla scelta carte…';
    location.href='choose.html?game='+G+'&role='+R;
  };
  qs('#decline').onclick = async ()=>{
    await DB.ref('games/'+G+'/phase').set('declined');
    stat.value='Hai rifiutato.';
  };
})();
</script>
</body></html>
